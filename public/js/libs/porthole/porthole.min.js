!function(a,b){"function"==typeof define&&define.amd?define(b):a.Porthole=b()}(this,function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=s.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0))if(b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;j<a.length;j+=1)if(l=a[j],"."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))break;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[];if(f=f||a,"function"==typeof c){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c.apply(q[a],u),a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){return"string"==typeof a?p[a]?p[a](b):j(o(a,b).f):(a.splice||(s=a,b.splice?(a=b,b=c,c=null):a=d),b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n)},n.config=function(a){return s=a,s.deps&&n(s.deps,s.callback),n},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../build/almond",function(){}),c("Log",["require"],function(){"use strict";var a={trace:function(a){void 0!==window.console&&window.console.log("Porthole: "+a)},error:function(a){void 0!==window.console&&window.console.error("Porthole: "+a)}};return a}),c("Class",["require"],function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/,c=function(){};return c.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d},c}),function(){var a=!0,b=null;!function(d){function e(c){if("bug-string-char-index"==c)return"a"!="a"[0];var d,e="json"==c;if(e||"json-stringify"==c||"json-parse"==c){if("json-stringify"==c||e){var f=k.stringify,g="function"==typeof f&&l;if(g){(d=function(){return 1}).toJSON=d;try{g="0"===f(0)&&"0"===f(new Number)&&'""'==f(new String)&&f(i)===h&&f(h)===h&&f()===h&&"1"===f(d)&&"[1]"==f([d])&&"[null]"==f([h])&&"null"==f(b)&&"[null,null,null]"==f([h,i,b])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==f({a:[d,a,!1,b,"\x00\b\n\f\r	"]})&&"1"===f(b,d)&&"[\n 1,\n 2\n]"==f([1,2],b,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(j){g=!1}}if(!e)return g}if("json-parse"==c||e){if(c=k.parse,"function"==typeof c)try{if(0===c("0")&&!c(!1)){d=c('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var m=5==d.a.length&&1===d.a[0];if(m){try{m=!c('"	"')}catch(n){}if(m)try{m=1!==c("01")}catch(o){}}}}catch(p){m=!1}if(!e)return m}return g&&m}}var f,g,h,i={}.toString,j="function"==typeof c&&c.amd,k="object"==typeof exports&&exports;k||j?"object"==typeof JSON&&JSON?k?(k.stringify=JSON.stringify,k.parse=JSON.parse):k=JSON:j&&(k=d.JSON={}):k=d.JSON||(d.JSON={});var l=new Date(-0xc782b5b800cec);try{l=-109252==l.getUTCFullYear()&&0===l.getUTCMonth()&&1===l.getUTCDate()&&10==l.getUTCHours()&&37==l.getUTCMinutes()&&6==l.getUTCSeconds()&&708==l.getUTCMilliseconds()}catch(m){}if(!e("json")){var n=e("bug-string-char-index");if(!l)var o=Math.floor,p=[0,31,59,90,120,151,181,212,243,273,304,334],q=function(a,b){return p[b]+365*(a-1970)+o((a-1969+(b=+(b>1)))/4)-o((a-1901+b)/100)+o((a-1601+b)/400)};if((f={}.hasOwnProperty)||(f=function(a){var c,d={};return(d.__proto__=b,d.__proto__={toString:1},d).toString!=i?f=function(a){var c=this.__proto__,a=(this.__proto__=b,a in this);return this.__proto__=c,a}:(c=d.constructor,f=function(a){var b=(this.constructor||c).prototype;return a in this&&!(a in b&&this[a]===b[a])}),d=b,f.call(this,a)}),g=function(a,c){var d,e,g,h=0;(d=function(){this.valueOf=0}).prototype.valueOf=0,e=new d;for(g in e)f.call(e,g)&&h++;d=e=b,h?h=2==h?function(a,b){var c,d={},e="[object Function]"==i.call(a);for(c in a)!(e&&"prototype"==c)&&!f.call(d,c)&&(d[c]=1)&&f.call(a,c)&&b(c)}:function(a,b){var c,d,e="[object Function]"==i.call(a);for(c in a)!(e&&"prototype"==c)&&f.call(a,c)&&!(d="constructor"===c)&&b(c);(d||f.call(a,c="constructor"))&&b(c)}:(e=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],h=function(a,b){var c,d="[object Function]"==i.call(a);for(c in a)!(d&&"prototype"==c)&&f.call(a,c)&&b(c);for(d=e.length;c=e[--d];f.call(a,c)&&b(c));}),h(a,c)},!e("json-stringify")){var r={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},s=function(a,b){return("000000"+(b||0)).slice(-a)},t=function(a){var b,c='"',d=0,e=a.length,f=e>10&&n;for(f&&(b=a.split(""));e>d;d++){var g=a.charCodeAt(d);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:c+=r[g];break;default:if(32>g){c+="\\u00"+s(2,g.toString(16));break}c+=f?b[d]:n?a.charAt(d):a[d]}}return c+'"'},u=function(c,d,e,j,k,l,m){var n,p,r,v,w,x,y,z,A,B=d[c];try{B=d[c]}catch(C){}if("object"==typeof B&&B)if(n=i.call(B),"[object Date]"!=n||f.call(B,"toJSON"))"function"==typeof B.toJSON&&("[object Number]"!=n&&"[object String]"!=n&&"[object Array]"!=n||f.call(B,"toJSON"))&&(B=B.toJSON(c));else if(B>-1/0&&1/0>B){if(q){for(r=o(B/864e5),n=o(r/365.2425)+1970-1;q(n+1,0)<=r;n++);for(p=o((r-q(n,0))/30.42);q(n,p+1)<=r;p++);r=1+r-q(n,p),v=(B%864e5+864e5)%864e5,w=o(v/36e5)%24,x=o(v/6e4)%60,y=o(v/1e3)%60,v%=1e3}else n=B.getUTCFullYear(),p=B.getUTCMonth(),r=B.getUTCDate(),w=B.getUTCHours(),x=B.getUTCMinutes(),y=B.getUTCSeconds(),v=B.getUTCMilliseconds();B=(0>=n||n>=1e4?(0>n?"-":"+")+s(6,0>n?-n:n):s(4,n))+"-"+s(2,p+1)+"-"+s(2,r)+"T"+s(2,w)+":"+s(2,x)+":"+s(2,y)+"."+s(3,v)+"Z"}else B=b;if(e&&(B=e.call(d,c,B)),B===b)return"null";if(n=i.call(B),"[object Boolean]"==n)return""+B;if("[object Number]"==n)return B>-1/0&&1/0>B?""+B:"null";if("[object String]"==n)return t(B);if("object"==typeof B){for(c=m.length;c--;)if(m[c]===B)throw TypeError();if(m.push(B),z=[],d=l,l+=k,"[object Array]"==n){for(p=0,c=B.length;c>p;A||(A=a),p++)n=u(p,B,e,j,k,l,m),z.push(n===h?"null":n);c=A?k?"[\n"+l+z.join(",\n"+l)+"\n"+d+"]":"["+z.join(",")+"]":"[]"}else g(j||B,function(b){var c=u(b,B,e,j,k,l,m);c!==h&&z.push(t(b)+":"+(k?" ":"")+c),A||(A=a)}),c=A?k?"{\n"+l+z.join(",\n"+l)+"\n"+d+"}":"{"+z.join(",")+"}":"{}";return m.pop(),c}};k.stringify=function(a,b,c){var d,e,f;if("function"==typeof b||"object"==typeof b&&b)if("[object Function]"==i.call(b))e=b;else if("[object Array]"==i.call(b)){f={};for(var g,h=0,j=b.length;j>h;g=b[h++],("[object String]"==i.call(g)||"[object Number]"==i.call(g))&&(f[g]=1));}if(c)if("[object Number]"==i.call(c)){if((c-=c%1)>0)for(d="",c>10&&(c=10);d.length<c;d+=" ");}else"[object String]"==i.call(c)&&(d=c.length<=10?c:c.slice(0,10));return u("",(g={},g[""]=a,g),e,f,d,"",[])}}if(!e("json-parse")){var v,w,x=String.fromCharCode,y={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},z=function(){throw v=w=b,SyntaxError()},A=function(){for(var c,d,e,f,g,h=w,i=h.length;i>v;)switch(g=h.charCodeAt(v)){case 9:case 10:case 13:case 32:v++;break;case 123:case 125:case 91:case 93:case 58:case 44:return c=n?h.charAt(v):h[v],v++,c;case 34:for(c="@",v++;i>v;)if(g=h.charCodeAt(v),32>g)z();else if(92==g)switch(g=h.charCodeAt(++v)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:c+=y[g],v++;break;case 117:for(d=++v,e=v+4;e>v;v++)g=h.charCodeAt(v),g>=48&&57>=g||g>=97&&102>=g||g>=65&&70>=g||z();c+=x("0x"+h.slice(d,v));break;default:z()}else{if(34==g)break;for(g=h.charCodeAt(v),d=v;g>=32&&92!=g&&34!=g;)g=h.charCodeAt(++v);c+=h.slice(d,v)}if(34==h.charCodeAt(v))return v++,c;z();default:if(d=v,45==g&&(f=a,g=h.charCodeAt(++v)),g>=48&&57>=g){for(48==g&&(g=h.charCodeAt(v+1),g>=48&&57>=g)&&z();i>v&&(g=h.charCodeAt(v),g>=48&&57>=g);v++);if(46==h.charCodeAt(v)){for(e=++v;i>e&&(g=h.charCodeAt(e),g>=48&&57>=g);e++);e==v&&z(),v=e}if(g=h.charCodeAt(v),101==g||69==g){for(g=h.charCodeAt(++v),(43==g||45==g)&&v++,e=v;i>e&&(g=h.charCodeAt(e),g>=48&&57>=g);e++);e==v&&z(),v=e}return+h.slice(d,v)}if(f&&z(),"true"==h.slice(v,v+4))return v+=4,a;if("false"==h.slice(v,v+5))return v+=5,!1;if("null"==h.slice(v,v+4))return v+=4,b;z()}return"$"},B=function(b){var c,d;if("$"==b&&z(),"string"==typeof b){if("@"==b[0])return b.slice(1);if("["==b){for(c=[];b=A(),"]"!=b;d||(d=a))d&&(","==b?(b=A(),"]"==b&&z()):z()),","==b&&z(),c.push(B(b));return c}if("{"==b){for(c={};b=A(),"}"!=b;d||(d=a))d&&(","==b?(b=A(),"}"==b&&z()):z()),(","==b||"string"!=typeof b||"@"!=b[0]||":"!=A())&&z(),c[b.slice(1)]=B(A());return c}z()}return b},C=function(a,b,c){c=D(a,b,c),c===h?delete a[b]:a[b]=c},D=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if("[object Array]"==i.call(e))for(d=e.length;d--;)C(e,d,c);else g(e,function(a){C(e,a,c)});return c.call(a,b,e)};k.parse=function(a,c){var d,e;return v=0,w=""+a,d=B(A()),"$"!=A()&&z(),v=w=b,c&&"[object Function]"==i.call(c)?D((e={},e[""]=d,e),"",c):d}}}j&&c("JSON",[],function(){return k})}(this)}(),c("WindowProxyBase",["require","Class","JSON"],function(a){"use strict";var b=a("Class"),c=a("JSON"),d=b.extend({init:function(a){void 0===a&&(a=""),this.targetWindowName=a,this.origin=window.location.protocol+"//"+window.location.host,this.eventListeners=[]},getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},getTargetWindow:function(){return this._getTargetWindow(this.targetWindowName)},post:function(a,b){void 0===b&&(b="*"),this.dispatchMessage({data:a,sourceOrigin:this.getOrigin(),targetOrigin:b,sourceWindowName:window.name,targetWindowName:this.getTargetWindowName()})},addEventListener:function(a){return this.eventListeners.push(a),a},removeEventListener:function(a){var b;try{b=this.eventListeners.indexOf(a),this.eventListeners.splice(b,1)}catch(c){this.eventListeners=[]}},dispatchEvent:function(a){var b;for(b=0;b<this.eventListeners.length;b++)this.eventListeners[b](a)},serialize:function(a){if("undefined"==typeof c)throw new Error("Porthole serialization depends on JSON!");return c.stringify(a)},unserialize:function(a){if("undefined"==typeof c)throw new Error("Porthole unserialization dependens on JSON!");try{var b=c.parse(a);return b}catch(d){return!1}},_getTargetWindow:function(a){return""===a?top:"top"===a||"parent"===a?window[a]:parent.frames[a]}});return d}),c("WindowProxy",["require"],function(){"use strict";var a=function(){};return a.prototype={post:function(){},addEventListener:function(){},removeEventListener:function(){}},a}),c("WindowProxyLegacy",["require","WindowProxyBase","Log","WindowProxy"],function(a){"use strict";var b=a("WindowProxyBase"),c=a("Log"),d=a("WindowProxy"),e=b.extend({init:function(a,b){this._super(b),null!==a?(this.proxyIFrameName=this.targetWindowName+"ProxyIFrame",this.proxyIFrameLocation=a,this.proxyIFrameElement=this.createIFrameProxy()):(this.proxyIFrameElement=null,c.trace("proxyIFrameUrl is null, window will be a receiver only"),this.post=function(){throw new Error("Receiver only window")})},createIFrameProxy:function(){var a=document.createElement("iframe");return a.setAttribute("id",this.proxyIFrameName),a.setAttribute("name",this.proxyIFrameName),a.setAttribute("src",this.proxyIFrameLocation),a.setAttribute("frameBorder","1"),a.setAttribute("scrolling","auto"),a.setAttribute("width",30),a.setAttribute("height",30),a.setAttribute("style","position: absolute; left: -100px; top:0px;"),a.style.setAttribute&&a.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;"),document.body.appendChild(a),a},dispatchMessage:function(a){var b=window.encodeURIComponent;if(this.proxyIFrameElement){var c=this.proxyIFrameLocation+"#"+b(d.serialize(a));this.proxyIFrameElement.setAttribute("src",c),this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100}}});return e}),c("MessageEvent",["require"],function(){"use strict";var a=function(a,b,c){this.data=a,this.origin=b,this.source=c};return a}),c("WindowProxyHTML5",["require","WindowProxyBase","MessageEvent"],function(a){"use strict";var b=a("WindowProxyBase"),c=a("MessageEvent"),d=b.extend({init:function(a,b){this._super(b),this.eventListenerCallback=null},dispatchMessage:function(a){this.getTargetWindow().postMessage(this.serialize(a),a.targetOrigin)},addEventListener:function(a){if(0===this.eventListeners.length){var b=this;window.addEventListener?(this.eventListenerCallback=function(a){b.eventListener(b,a)},window.addEventListener("message",this.eventListenerCallback,!1)):window.attachEvent&&(this.eventListenerCallback=function(){b.eventListener(b,window.event)},window.attachEvent("onmessage",this.eventListenerCallback))}return this._super(a)},removeEventListener:function(a){this._super(a),0===this.eventListeners.length&&(window.removeEventListener?window.removeEventListener("message",this.eventListenerCallback):window.detachEvent&&("undefined"==typeof window.onmessage&&(window.onmessage=null),window.detachEvent("onmessage",this.eventListenerCallback)),this.eventListenerCallback=null)},eventListener:function(a,b){var d=this.unserialize(b.data);!d||""!=a.targetWindowName&&d.sourceWindowName!=a.targetWindowName||a.dispatchEvent(new c(d.data,b.origin,a))}});return d}),c("main",["require","Log","WindowProxyLegacy","WindowProxyHTML5"],function(a){"use strict";var b=a("Log"),c={trace:b.trace,error:b.error,WindowProxyLegacy:a("WindowProxyLegacy"),WindowProxyHTML5:a("WindowProxyHTML5")};return window.postMessage?(c.trace("Using built-in browser support"),c.WindowProxy=c.WindowProxyHTML5.extend({})):(c.trace("Using legacy browser support"),c.WindowProxy=c.WindowProxyLegacy.extend({})),c}),b("main")});